cuml   = cumsum(check)
) %>%
# filter(WBAREACOMI == 0) %>%
mutate(across(where(is.numeric), as.character)) %>%
dplyr::select(COMID, hydroseq = Hydroseq, check, cuml, LENGTHKM, arb_sum = ArbolateSu, StreamOrde, streamleve) %>%
mutate(
arb_sum     = as.numeric(arb_sum)
)
split_df <-
ut_net %>%
arrange(Hydroseq)  %>%
mutate(
check  = ifelse(COMID %in% comid_df$origin_comid, 1, 0),
cuml   = cumsum(check)
) %>%
# filter(WBAREACOMI == 0) %>%
mutate(across(where(is.numeric), as.character)) %>%
dplyr::select(COMID, hydroseq = Hydroseq, check, cuml, LENGTHKM, arb_sum = ArbolateSu, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum),
arb_sum_cuml     = cumsum(arb_sum)
)
View(split_df)
split_df <-
ut_net %>%
arrange(Hydroseq)  %>%
mutate(
check  = ifelse(COMID %in% comid_df$origin_comid, 1, 0),
cuml   = cumsum(check)
) %>%
# filter(WBAREACOMI == 0) %>%
mutate(across(where(is.numeric), as.character)) %>%
dplyr::select(COMID, hydroseq = Hydroseq, check, cuml, LENGTHKM, arb_sum = ArbolateSu, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum),
arb_sum_cuml     = cumsum(arb_sum)
) %>%
dplyr::relocate(COMID, hydroseq, check, cuml, arb_sum, arb_sum_cuml)
View(split_df)
split_df <-
ut_net %>%
arrange(Hydroseq)  %>%
mutate(
check  = ifelse(COMID %in% comid_df$origin_comid, 1, 0),
cuml   = cumsum(check)
) %>%
# filter(WBAREACOMI == 0) %>%
mutate(across(where(is.numeric), as.character)) %>%
dplyr::select(COMID, hydroseq = Hydroseq, check, cuml, LENGTHKM, arb_sum = ArbolateSu, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum),
arb_sum_diff     = arb_sum - lag(arb_sum),
arb_sum_cuml     = cumsum(arb_sum)
) %>%
dplyr::relocate(COMID, hydroseq, check, cuml, arb_sum, arb_sum_diff, arb_sum_cuml)
fline_pts
fline_pts
fline_pts %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq, check, cuml, LENGTHKM, arb_sum = ArbolateSu, StreamOrde, streamleve)
fline_pts %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq, LENGTHKM, arb_sum = ArbolateSu, StreamOrde, streamleve)
fline_connect <- readRDS("data/spatial/points/lhd_flowline_connectivity.rds")
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq, LENGTHKM, arb_sum = ArbolateSu, StreamOrde, streamleve, us_length, ds_length, total_length)
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, StreamOrde, streamleve, LENGTHKM) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length, arb_sum)
View(pts)
mutate(across(everything(), round))
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, StreamOrde, streamleve, LENGTHKM) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length, arb_sum) %>%
mutate(across(everything(), round))
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, StreamOrde, streamleve, LENGTHKM) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length, arb_sum) %>%
mutate(across(where(is.numeric), round))
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, StreamOrde, streamleve, LENGTHKM) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length, arb_sum) %>%
mutate(across(where(is.numeric), round, 2))
View(pts)
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, StreamOrde, streamleve, LENGTHKM) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length, arb_sum) %>%
mutate(across(where(is.numeric), round, 2)) %>%
arrange(hydroseq)
View(pts)
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, StreamOrde, streamleve, LENGTHKM) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length, arb_sum) %>%
mutate(across(where(is.numeric), round, 2)) %>%
arrange(hydroseq)
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, LevelPathI, StreamOrde, streamleve, LENGTHKM) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length, arb_sum) %>%
mutate(across(where(is.numeric), round, 2)) %>%
arrange(hydroseq)
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, LevelPathI, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length, arb_sum) %>%
mutate(across(where(is.numeric), round, 2)) %>%
arrange(hydroseq)
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, LevelPathI, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length, arb_sum) %>%
mutate(across(where(is.numeric), round, 2)) %>%
group_by(LevelPathI) %>%
arrange(hydroseq, .by_group = T)
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, LevelPathI, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length, arb_sum) %>%
mutate(across(where(is.numeric), round, 2)) %>%
group_by(LevelPathI) %>%
arrange(hydroseq, .by_group = T) %>%
mutate(
arb_sum_diff = lead(arb_sum)
)
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, LevelPathI, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
mutate(across(where(is.numeric), round, 2)) %>%
group_by(LevelPathI) %>%
arrange(hydroseq, .by_group = T) %>%
mutate(
arb_sum_diff = lead(arb_sum)
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length, arb_sum, arb_sum_diff) %>%
# ***************************
# ---- Network flowlines ----
# ***************************
# Download network of NHDplus flowlines
# Start of each mainstem (Unique LevelPathI in NHDplus)
start_fline <-
fline_pts %>%
group_by(LevelPathI) %>%
arrange(Hydroseq, .by_group = T) %>%
slice_head() %>%
ungroup()
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, LevelPathI, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
mutate(across(where(is.numeric), round, 2)) %>%
group_by(LevelPathI) %>%
arrange(hydroseq, .by_group = T) %>%
mutate(
arb_sum_diff = lead(arb_sum)
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length, arb_sum, arb_sum_diff)
View(pts)
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, LevelPathI, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
mutate(across(where(is.numeric), round, 2)) %>%
group_by(LevelPathI) %>%
arrange(hydroseq, .by_group = T) %>%
mutate(
arb_sum_lead = lead(arb_sum),
arb_sum_diff = diff(arb_sum)
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length, arb_sum, arb_sum_lead, arb_sum_diff)
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, LevelPathI, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
mutate(across(where(is.numeric), round, 2)) %>%
group_by(LevelPathI) %>%
arrange(hydroseq, .by_group = T) %>%
mutate(
arb_sum_lead = lead(arb_sum),
arb_sum_diff = diff(arb_sum)
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length,
arb_sum, arb_sum_lead, arb_sum_diff)
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, LevelPathI, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
mutate(across(where(is.numeric), round, 2)) %>%
group_by(LevelPathI) %>%
arrange(hydroseq, .by_group = T) %>%
mutate(
arb_sum_lead = lead(arb_sum),
arb_sum_diff = diff(arb_sum, 1)
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length,
arb_sum, arb_sum_lead, arb_sum_diff)
1:10
diff(1:10, 2)
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, LevelPathI, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
mutate(across(where(is.numeric), round, 2)) %>%
group_by(LevelPathI) %>%
arrange(hydroseq, .by_group = T) %>%
ungroup() %>%
mutate(
arb_sum_lead = lead(arb_sum),
arb_sum_diff = diff(arb_sum, 1)
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length,
arb_sum, arb_sum_lead, arb_sum_diff)
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, LevelPathI, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
mutate(across(where(is.numeric), round, 2)) %>%
group_by(LevelPathI) %>%
arrange(hydroseq, .by_group = T) %>%
mutate(
arb_sum_lead = lead(arb_sum),
arb_sum_lag  = lag(arb_sum)
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length,
arb_sum, arb_sum_lead, arb_sum_diff)
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, LevelPathI, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
mutate(across(where(is.numeric), round, 2)) %>%
group_by(LevelPathI) %>%
arrange(hydroseq, .by_group = T) %>%
mutate(
arb_sum_lead = lead(arb_sum),
arb_sum_lag  = lag(arb_sum)
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length,
arb_sum, arb_sum_lead, arb_sum_lag)
View(pts)
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, LevelPathI, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
mutate(across(where(is.numeric), round, 2)) %>%
group_by(LevelPathI) %>%
arrange(hydroseq, .by_group = T) %>%
mutate(
arb_sum_lead = lead(arb_sum),
arb_sum_lag  = lag(arb_sum),
arb_sum_diff = arb_sum - arb_sum_lead
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length,
arb_sum, arb_sum_lead, arb_sum_lag, arb_sum_diff)
ggplot() +
geom_sf(data = pts, aes(color = arb_sum))
fline_connect
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, LevelPathI, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
mutate(across(where(is.numeric), round, 2)) %>%
group_by(LevelPathI) %>%
arrange(hydroseq, .by_group = T) %>%
mutate(
arb_sum_lead = lead(arb_sum),
arb_sum_lag  = lag(arb_sum),
arb_sum_diff = arb_sum - arb_sum_lead
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length,
arb_sum, arb_sum_lead, arb_sum_lag, arb_sum_diff)
pts
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, LevelPathI, StreamOrde, streamleve)
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, LevelPathI, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
mutate(across(where(is.numeric), round, 2)) %>%
group_by(LevelPathI) %>%
arrange(hydroseq, .by_group = T) %>%
mutate(
arb_sum_lead = lead(arb_sum),
arb_sum_lag  = lag(arb_sum),
arb_sum_diff = arb_sum - arb_sum_lead
)
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, LevelPathI, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
mutate(across(where(is.numeric), round, 2)) %>%
group_by(LevelPathI) %>%
arrange(hydroseq, .by_group = T) %>%
mutate(
arb_sum_lead = lead(arb_sum),
arb_sum_lag  = lag(arb_sum),
arb_sum_diff = arb_sum - arb_sum_lead
) %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length,
arb_sum, arb_sum_lead, arb_sum_lag, arb_sum_diff)
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, LevelPathI, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
mutate(across(where(is.numeric), round, 2)) %>%
group_by(LevelPathI) %>%
arrange(hydroseq, .by_group = T) %>%
mutate(
arb_sum_lead = lead(arb_sum),
arb_sum_lag  = lag(arb_sum),
arb_sum_diff = arb_sum - arb_sum_lead
) %>%
ungroup()
pts
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length,
arb_sum, arb_sum_lead, arb_sum_lag, arb_sum_diff, geometry)
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, LevelPathI, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
mutate(across(where(is.numeric), round, 2)) %>%
group_by(LevelPathI) %>%
arrange(hydroseq, .by_group = T) %>%
mutate(
arb_sum_lead = lead(arb_sum),
arb_sum_lag  = lag(arb_sum),
arb_sum_diff = arb_sum - arb_sum_lead
) %>%
ungroup()
pts <-
fline_connect %>%
dplyr::select(new_id, COMID, hydroseq = Hydroseq,
us_length, ds_length, total_length,
arb_sum = ArbolateSu, LevelPathI, StreamOrde, streamleve) %>%
mutate(
arb_sum          = as.numeric(arb_sum)
# arb_sum_diff     = arb_sum - lag(arb_sum),
# arb_sum_cuml     = cumsum(arb_sum)
) %>%
mutate(across(where(is.numeric), round, 2)) %>%
group_by(LevelPathI) %>%
arrange(hydroseq, .by_group = T) %>%
mutate(
arb_sum_lead = lead(arb_sum),
arb_sum_lag  = lag(arb_sum),
arb_sum_diff = arb_sum - arb_sum_lead
) %>%
ungroup() %>%
dplyr::relocate(new_id, COMID, hydroseq, us_length, ds_length, total_length,
arb_sum, arb_sum_lead, arb_sum_lag, arb_sum_diff, geometry)
pts
ggplot() +
geom_sf(data = pts, aes(color = arb_sum))
ggplot() +
geom_sf(data = pts, aes(color = arb_sum_diff))
